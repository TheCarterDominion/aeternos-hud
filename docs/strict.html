<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no">
<title>Aeternos • Strict (Silk Audio Safe)</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#04102a;color:#ecf3ff}
  main{max-width:820px;margin:24px auto;padding:16px}
  button{padding:14px 16px;border:2px solid #8cc2ff;border-radius:12px;background:#0b1734;color:#ecf3ff;font-size:16px;margin:6px 8px 6px 0}
  .pill{display:inline-block;border:1px solid #6e87b8;border-radius:999px;padding:6px 10px;margin:6px 8px 6px 0}
  #pad{height:40vh;border:2px dashed #7aa2e3;border-radius:14px;margin-top:10px;display:flex;align-items:center;justify-content:center}
  #log{white-space:pre-wrap;background:#0b1734;border:1px solid rgba(255,255,255,.25);padding:10px;border-radius:12px;margin-top:12px;max-height:30vh;overflow:auto}
  label{display:inline-flex;gap:.5rem;align-items:center}
</style>
</head>
<body>
<main>
  <h1>Strict (Silk Audio Safe)</h1>
  <div>
    <button id="btn-enable">Enable Audio</button>
    <button id="btn-beep">Beep</button>
    <label><input id="show-ctrls" type="checkbox"> Show native audio controls (fallback)</label>
    <span class="pill" id="state">Audio: Off</span>
  </div>
  <div>
    <button id="btn-tap">Tap Counter</button>
    <span class="pill">Taps: <b id="count">0</b></span>
    <span class="pill" id="last">—</span>
  </div>
  <div id="pad">Tap inside this area</div>

  <audio id="beep" preload="auto" playsinline>
    <source src="data:audio/wav;base64,UklGRhQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAlAAAAPwAAABkAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==" type="audio/wav">
  </audio>

  <div id="log" aria-live="polite"></div>
</main>

<script>
(function(){
  function $(id){return document.getElementById(id);}
  var state=$('state'), last=$('last'), cnt=$('count'), pad=$('pad'), logEl=$('log'), taps=0;
  var B=$('beep'), enableBtn=$('btn-enable'), beepBtn=$('btn-beep'), tapBtn=$('btn-tap'), showCtrls=$('show-ctrls');

  function log(msg){ var t=new Date().toLocaleTimeString(); logEl.textContent+="["+t+"] "+msg+"\n"; logEl.scrollTop=logEl.scrollHeight; }
  function setLast(x){ if(last) last.textContent = x; }
  function bump(){ taps++; if(cnt) cnt.textContent = String(taps); }

  function bindTap(el, fn){
    if(!el) return;
    el.addEventListener('touchstart', function(e){ fn(); e.preventDefault(); }, {passive:false});
    el.addEventListener('click', fn);
  }

  bindTap(tapBtn, bump);
  if(pad){
    pad.addEventListener('touchstart', function(e){ bump(); setLast('touchstart-pad'); e.preventDefault(); }, {passive:false});
    pad.addEventListener('click', function(){ bump(); setLast('click-pad'); });
    pad.addEventListener('mousedown', function(){ bump(); setLast('mousedown-pad'); });
  }

  showCtrls.addEventListener('change', function(){ B.controls = this.checked; });

  function enableAudio(){
    if(!B){ log("No <audio> element present"); return; }
    try{
      B.currentTime = 0;
      var p = B.play();
      if(p && typeof p.then === 'function'){
        p.then(function(){ B.pause(); state.textContent="Audio: On"; log("Audio unlocked via <audio>."); })
         .catch(function(err){ log("play() rejected: "+err); state.textContent="Audio: Off"; });
      }else{
        state.textContent="Audio: On (no-promise)";
        log("Audio unlocked (no promise).");
      }
    }catch(e){ log("Enable error: "+e); }
  }

  function beep(){
    if(!B){ log("No <audio> element present"); return; }
    try{
      B.currentTime = 0;
      var p = B.play();
      if(p && typeof p.catch === 'function'){ p.catch(function(err){ log("Beep play() error: "+err); }); }
    }catch(e){ log("Beep error: "+e); }
  }

  bindTap(enableBtn, enableAudio);
  bindTap(beepBtn, beep);

  ['pointerdown','click','touchstart','keydown','visibilitychange'].forEach(function(ev){
    window.addEventListener(ev,function(){ setLast(ev); log("Event: "+ev); }, {passive:true});
  });

  log("Ready. Tap 'Enable Audio' once, then 'Beep'. If blocked, toggle 'Show native audio controls' and press Play.");
})();
</script>
</body>
</html>
